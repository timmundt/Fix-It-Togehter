{% extends "repairer_base.html" %}

{% block title %}Meine Aufträge | FixItTogether{% endblock %}

{% block user_content %}
<h2 class="account-headline"> Meine Aufträge </h2> 

<form method="GET" class="mb-4">
    <label for="status" class="text-white me-2">Status filtern:</label>
    <select class="form-select w-auto d-inline" id="status" name="status" onchange="this.form.submit()">
      <option value="" {% if not status %}selected{% endif %}>Alle</option>
      <option value="open" {% if status == 'open' %}selected{% endif %}>Laufend</option>
      <option value="finished" {% if status == 'finished' %}selected{% endif %}>Abgeschlossen</option>
    </select>
  </form>

  {% if tickets %}
    {% for ticket in tickets%}
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">{{ ticket.model }}</h5>
          <p class="card-text">{{ ticket.init_message }}</p>  
          <form action="{{ url_for('repairer.open_chat') }}" method="post">
            <input type="hidden" name="ticket_id" value="{{ ticket.ticket_id }}">
          <button type="submit" class="btn btn-success btn-sm">Chat</button>
          </form>
          <form action="{{ url_for('repairer.close_ticket') }}" method="post">
            <input type="hidden" name="ticket_id" value="{{ ticket.ticket_id }}">
          <button type="submit" class="btn btn-danger btn-sm">Abschließen</button>
          </form>
        </div>
      </div>
    {% endfor %}
  {% else %}
    <p>Keine Aufträge</p>
  {% endif %}

{% endblock %}